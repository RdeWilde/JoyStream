#!/bin/bash
spec=`qmake -query QMAKE_XSPEC`

if [ "$spec" != "macx-clang" ]
then
  echo "osx build environment not correctly setup"
  exit -1
fi

pushd bitcoin/src/detail/store
make clean
make
popd

pushd deps/osx/
./build-all.sh
popd

mkdir -p build/osx
cd build/osx
rm -fr app/app.app
make clean
qmake ../../JoyStream.pro -r -spec macx-clang CONFIG+=x86_64 DEFINES+=QT_FORCE_ASSERTS && \
  make && \
  macdeployqt app/app.app
